<button id="test" type="button">Upload to IPFS</button>
<button id="change-port" type="button">Change node</button>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.13.1/dist/sweetalert2.all.min.js"></script>
<script src="inject.js"></script>
<script>
    document.getElementById('test').addEventListener('click', function() {
        uploadImageToIpfs(function(files) {
            console.log(files);
        })
    });
</script>
<script>
    document.getElementById('change-port').addEventListener('click', async function(e) {

        let ss = await swal({
            title: 'Hosts',
            html: `<div id="change-port-html">
                        <p>
                        <div class="input-group mb-3">
                        <input id="input-api-protocol" type="text" class="form-control" placeholder="protocol">
                        <input id="input-api-address" type="text" class="form-control" placeholder="address">
                        <input id="input-api-port" type="text" class="form-control" placeholder="port">
                        </div>
                        </p>
                        <p>
                        <div class="input-group mb-3">
                        <input id="input-gateway-protocol" type="text" class="form-control" placeholder="protocol">
                        <input id="input-gateway-address" type="text" class="form-control" placeholder="address">
                        <input id="input-gateway-port" type="text" class="form-control" placeholder="port">
                        </div>
                        </p>
                        </div>`,
            type: 'info',
            buttonsStyling: true,
            position: 'top',
            showCloseButton: true,
            showCancelButton: true,
            preConfirm: async () => {
                let {
                    obj: full,
                    sendObj: result
                } = await getInputsFromChange(),
                    good = {
                        api: '',
                        gateway: ''
                    }
                for (let i in result) {
                    result[i].length != 3 && result[i].length > 0 ? good[i] = false : good[i] = true;
                }
                console.log(full);
                for (let i in full) {
                    if (full[i].some((item) => {
                            return item.value == '' && !good[i]
                        })) {
                        console.log(i, full[i], false);
                        full[i].forEach((item) => {
                            if (item.value == '') item.setAttribute('class', 'form-control is-invalid');
                            else item.setAttribute('class', 'form-control');
                        });
                    }
                }
                if (good.api && good.gateway) {
                    for (let i in full) {
                        full[i].forEach((item) => {
                            console.log('true', full[i]);
                            let arr = item.id.split('-'),
                                conn = connectionNew[arr[1]];
                            if (item.value != '') conn[arr[2]] = item.value;
                        });
                    }
                    return true;
                } else {
                    console.log(false);
                    return new Promise(resolve => {
                        swal.showValidationError(`Please enter full gateway or&and api inputs`);
                        resolve();
                    })
                }
            }
        });
        initConnection(connectionNew)
    })


    async function getInputsFromChange() {
        let obj = {
            api: [],
            gateway: [],
        }
        sendObj = {
            api: [],
            gateway: []
        }
        let arr = [];
        let ss = document.getElementById('change-port-html').getElementsByTagName('input');

        for (let i = 0; i < ss.length; i++) {
            obj[ss[i].id.split('-')[1]].push(ss[i]);

        }
        for (let i in sendObj) {
            sendObj[i] = obj[i].filter((item) => {
                if (item.value != '') return item;
            });
        }
        return {
            sendObj,
            obj
        };
    }
</script>